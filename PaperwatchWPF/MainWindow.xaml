<Window x:Class="PaperwatchWPF.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        xmlns:local="clr-namespace:PaperwatchWPF"
        mc:Ignorable="d"
        Title="Paperwatch" Height="600" Width="1000"
        WindowStyle="None" AllowsTransparency="True" Background="Transparent"
        WindowStartupLocation="CenterScreen">
    
    <Window.Resources>
        <!-- Sleek Slider Style -->
        <Style x:Key="SleekSliderStyle" TargetType="Slider">
            <Setter Property="Background" Value="Transparent"/>
            <Setter Property="BorderThickness" Value="0"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="Slider">
                        <Grid>
                            <Border Name="TrackBackground" Height="4" Background="#333" CornerRadius="2" VerticalAlignment="Center" Margin="0,0"/>
                            <Track Name="PART_Track">
                                <Track.DecreaseRepeatButton>
                                    <RepeatButton Command="{x:Static Slider.DecreaseLarge}">
                                        <RepeatButton.Template>
                                            <ControlTemplate TargetType="RepeatButton">
                                                <Border Height="4" Background="SkyBlue" CornerRadius="2" VerticalAlignment="Center"/>
                                            </ControlTemplate>
                                        </RepeatButton.Template>
                                    </RepeatButton>
                                </Track.DecreaseRepeatButton>
                                <Track.Thumb>
                                    <Thumb Width="14" Height="14">
                                        <Thumb.Template>
                                            <ControlTemplate TargetType="Thumb">
                                                <Ellipse Fill="White" Stroke="SkyBlue" StrokeThickness="2" Width="14" Height="14">
                                                    <Ellipse.Effect>
                                                        <DropShadowEffect BlurRadius="5" Opacity="0.3" ShadowDepth="1"/>
                                                    </Ellipse.Effect>
                                                </Ellipse>
                                            </ControlTemplate>
                                        </Thumb.Template>
                                    </Thumb>
                                </Track.Thumb>
                            </Track>
                        </Grid>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>

        <Style x:Key="ControlButtonStyle" TargetType="Button">
            <Setter Property="Background" Value="Transparent"/>
            <Setter Property="BorderThickness" Value="0"/>
            <Setter Property="Foreground" Value="White"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="Button">
                        <Border Background="{TemplateBinding Background}" CornerRadius="10">
                            <ContentPresenter HorizontalAlignment="Center" VerticalAlignment="Center"/>
                        </Border>
                        <ControlTemplate.Triggers>
                            <Trigger Property="IsMouseOver" Value="True">
                                <Setter Property="Background" Value="#44FFFFFF"/>
                            </Trigger>
                            <Trigger Property="IsPressed" Value="True">
                                <Setter Property="Background" Value="#22FFFFFF"/>
                            </Trigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>

        <Style x:Key="CircularButtonStyle" TargetType="Button" BasedOn="{StaticResource ControlButtonStyle}">
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="Button">
                        <Grid>
                            <Ellipse Name="BgEllipse" Fill="{TemplateBinding Background}" Width="{TemplateBinding Width}" Height="{TemplateBinding Height}"/>
                            <ContentPresenter HorizontalAlignment="Center" VerticalAlignment="Center"/>
                        </Grid>
                        <ControlTemplate.Triggers>
                            <Trigger Property="IsMouseOver" Value="True">
                                <Setter TargetName="BgEllipse" Property="Fill" Value="#44FFFFFF"/>
                            </Trigger>
                            <Trigger Property="IsPressed" Value="True">
                                <Setter TargetName="BgEllipse" Property="Fill" Value="#22FFFFFF"/>
                            </Trigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>
    </Window.Resources>

    <Border Margin="10" CornerRadius="20" Background="#121212" BorderBrush="#444" BorderThickness="1.5" ClipToBounds="True">
        <Border.Effect>
            <DropShadowEffect BlurRadius="15" Direction="-90" RenderingBias="Quality" ShadowDepth="1" Opacity="0.4"/>
        </Border.Effect>
        <Grid>
            <Grid.RowDefinitions>
                <RowDefinition Height="40"/> <!-- Top Bar -->
                <RowDefinition Height="*"/>    <!-- Media Area -->
                <RowDefinition Height="110"/> <!-- Control Bar -->
            </Grid.RowDefinitions>

            <!-- Sleek Top Bar -->
            <Grid x:Name="topBar" Grid.Row="0" MouseLeftButtonDown="TopBar_MouseLeftButtonDown">
                <Border Background="#1E1E1E" CornerRadius="20,20,0,0"/>
                <StackPanel Orientation="Horizontal" VerticalAlignment="Center" Margin="15,0">
                    <TextBlock Text="Paperwatch" Foreground="#E0E0E0" FontWeight="SemiBold" VerticalAlignment="Center" Margin="0,0,20,0" FontSize="14"/>
                    <Menu Background="Transparent" VerticalAlignment="Center">
                        <MenuItem Header="File" Foreground="#AAA" Padding="8,4">
                            <MenuItem Header="Open Media..." Click="OpenMedia_Click"/>
                            <MenuItem Header="Settings" Click="Settings_Click"/>
                            <Separator/>
                            <MenuItem Header="Exit" Click="Exit_Click"/>
                        </MenuItem>
                    </Menu>
                </StackPanel>
                
                <StackPanel Orientation="Horizontal" HorizontalAlignment="Right" VerticalAlignment="Center" Margin="0,0,5,0">
                    <Button Content="&#xE949;" FontFamily="Segoe MDL2 Assets" Style="{StaticResource ControlButtonStyle}" Width="45" Height="40" Click="Minimize_Click" FontSize="10"/>
                    <Button x:Name="topFullscreenButton" Content="&#xE740;" FontFamily="Segoe MDL2 Assets" 
                            Style="{StaticResource ControlButtonStyle}" Width="45" Height="40" 
                            Click="Fullscreen_Click" ToolTip="Toggle Fullscreen" FontSize="10" Foreground="#888"/>
                    <Button Content="&#xE106;" FontFamily="Segoe MDL2 Assets" Style="{StaticResource ControlButtonStyle}" Width="45" Height="40" Click="Close_Click" FontSize="10"/>
                </StackPanel>
            </Grid>

            <!-- Media Content Area -->
            <Grid Grid.Row="1" Background="Black">
                <MediaElement x:Name="mediaElement" LoadedBehavior="Manual" UnloadedBehavior="Stop" 
                              MediaOpened="mediaElement_MediaOpened" MediaEnded="mediaElement_MediaEnded"
                              MediaFailed="mediaElement_MediaFailed"
                              MouseLeftButtonDown="mediaElement_MouseLeftButtonDown"/>
                
                <!-- Audio Metadata & Album Art Overlay -->
                <Grid x:Name="audioInfoPanel" Visibility="Collapsed" Background="#0A0A0A">
                    <StackPanel VerticalAlignment="Center" HorizontalAlignment="Center">
                        <Border x:Name="albumArtBorder" CornerRadius="15" Width="260" Height="260" Margin="0,0,0,30" BorderBrush="#333" BorderThickness="1">
                            <Border.Effect>
                                <DropShadowEffect BlurRadius="30" Opacity="0.5" ShadowDepth="0"/>
                            </Border.Effect>
                            <Grid>
                                <Rectangle Fill="#1A1A1A" RadiusX="15" RadiusY="15"/>
                                <!-- Placeholder icon if no art -->
                                <TextBlock Text="&#xE8D6;" FontFamily="Segoe MDL2 Assets" Foreground="#222" FontSize="80" 
                                           HorizontalAlignment="Center" VerticalAlignment="Center"/>
                                <Image x:Name="albumArtImage" Stretch="UniformToFill">
                                    <Image.OpacityMask>
                                        <VisualBrush>
                                            <VisualBrush.Visual>
                                                <Border Background="Black" CornerRadius="15" Width="260" Height="260"/>
                                            </VisualBrush.Visual>
                                        </VisualBrush>
                                    </Image.OpacityMask>
                                </Image>
                            </Grid>
                        </Border>
                        <TextBlock x:Name="songTitleText" Text="Unknown Title" Foreground="White" FontSize="28" FontWeight="Bold" HorizontalAlignment="Center" Margin="0,0,0,5"/>
                        <TextBlock x:Name="artistNameText" Text="Unknown Artist" Foreground="SkyBlue" FontSize="18" HorizontalAlignment="Center"/>
                    </StackPanel>
                </Grid>
                
                <!-- Overlay for empty state -->
                <TextBlock x:Name="emptyStateText" Text="No Media Loaded" Foreground="#333" FontSize="24" FontWeight="Bold" 
                           HorizontalAlignment="Center" VerticalAlignment="Center" Visibility="Visible"/>

                <!-- Settings Overlay -->
                <Grid x:Name="settingsOverlay" Background="#EA121212" Visibility="Collapsed">
                    <Border Background="#1E1E1E" CornerRadius="15" BorderBrush="#333" BorderThickness="1" 
                            Width="400" Height="300" HorizontalAlignment="Center" VerticalAlignment="Center">
                        <Grid Margin="20">
                            <TextBlock Text="Settings" Foreground="White" FontSize="18" FontWeight="SemiBold" HorizontalAlignment="Center"/>
                            <StackPanel VerticalAlignment="Center">
                                <TextBlock Text="File Associations" Foreground="#AAA" Margin="0,0,0,5"/>
                                <Button Content="Set as Default for .mp3 &amp; .mp4" Padding="15,8" Click="SetDefault_Click" 
                                        Background="#333" Foreground="White" BorderThickness="0" Margin="0,0,0,20"/>
                                
                                <TextBlock Text="Skip Interval (seconds)" Foreground="#AAA" Margin="0,0,0,5"/>
                                <StackPanel Orientation="Horizontal">
                                    <TextBox x:Name="skipIntervalBox" Width="60" Padding="5" Background="#222" Foreground="White" BorderBrush="#444" Text="10"/>
                                    <Button Content="Update" Margin="10,0,0,0" Padding="10,0" Click="UpdateSkipInterval_Click" Style="{StaticResource ControlButtonStyle}"/>
                                </StackPanel>
                                <TextBlock Text="Requires user confirmation in Windows registry" Foreground="#444" FontSize="9" Margin="0,5,0,0"/>
                            </StackPanel>
                            <Button Content="Close" HorizontalAlignment="Right" VerticalAlignment="Bottom" Padding="15,5" 
                                    Click="CloseSettings_Click" Style="{StaticResource ControlButtonStyle}"/>
                        </Grid>
                    </Border>
                </Grid>
            </Grid>

            <!-- Interactive Control Bar -->
            <Grid Grid.Row="2" x:Name="controlBar">
                <Border Background="#181818" CornerRadius="0,0,20,20"/>
                <Grid>
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="*"/>
                    </Grid.RowDefinitions>
                    
                    <!-- Timeline Slider -->
                    <Slider x:Name="timelineSlider" Grid.Row="0" Margin="20,10,20,0" 
                            Minimum="0" Maximum="1" Style="{StaticResource SleekSliderStyle}"
                            ValueChanged="timelineSlider_ValueChanged"
                            PreviewMouseLeftButtonDown="timelineSlider_PreviewMouseLeftButtonDown"
                            PreviewMouseLeftButtonUp="timelineSlider_PreviewMouseLeftButtonUp"
                            IsMoveToPointEnabled="True"
                            VerticalAlignment="Top" Height="20" Cursor="Hand"/>
                    
                    <Grid Grid.Row="1" Margin="20,0,20,10">
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="1*"/>
                            <ColumnDefinition Width="Auto"/>
                            <ColumnDefinition Width="1*"/>
                        </Grid.ColumnDefinitions>
   
                        <!-- Left: Time Status -->
                        <StackPanel Grid.Column="0" Orientation="Horizontal" VerticalAlignment="Center">
                            <TextBlock x:Name="currentTimeText" Text="00:00" Foreground="#888" FontSize="12"/>
                            <TextBlock Text="/" Foreground="#444" Margin="5,0" FontSize="12"/>
                            <TextBlock x:Name="totalTimeText" Text="00:00" Foreground="#888" FontSize="12"/>
                        </StackPanel>
   
                        <!-- Center: Playback Controls (Skip Backward, Play/Pause, Skip Forward) -->
                        <StackPanel Grid.Column="1" Orientation="Horizontal" VerticalAlignment="Center">
                            <Button x:Name="backButton" Content="&#xE112;" FontFamily="Segoe MDL2 Assets" FontSize="18" 
                                    Style="{StaticResource ControlButtonStyle}" Width="45" Height="45" 
                                    Click="Back_Click" ToolTip="Skip Backward" Foreground="#AAA"/>
                            
                            <Button x:Name="playPauseButton" Content="&#xE768;" FontFamily="Segoe MDL2 Assets" FontSize="26" 
                                    Style="{StaticResource CircularButtonStyle}" Width="60" Height="60" 
                                    Click="PlayPause_Click" ToolTip="Play" Margin="15,0"/>
                            
                            <Button x:Name="skipButton" Content="&#xE112;" FontFamily="Segoe MDL2 Assets" FontSize="18" 
                                    Style="{StaticResource ControlButtonStyle}" Width="45" Height="45" 
                                    Click="Skip_Click" ToolTip="Skip Forward" Foreground="#AAA" RenderTransformOrigin="0.5,0.5">
                                <Button.RenderTransform>
                                    <ScaleTransform ScaleX="-1"/>
                                </Button.RenderTransform>
                            </Button>
                        </StackPanel>
   
                        <!-- Right: Volume/Misc -->
                        <StackPanel Grid.Column="2" Orientation="Horizontal" HorizontalAlignment="Right" VerticalAlignment="Center">
                            <Button x:Name="fullscreenButton" Content="&#xEE40;" FontFamily="Segoe MDL2 Assets" FontSize="14" 
                                    Style="{StaticResource ControlButtonStyle}" Width="35" Height="35" 
                                    Click="Fullscreen_Click" Margin="0,0,10,0" ToolTip="Fullscreen Video" Foreground="#888"/>
                            <TextBlock Text="&#xE767;" FontFamily="Segoe MDL2 Assets" Foreground="#666" VerticalAlignment="Center" Margin="0,0,10,0" FontSize="14"/>
                            <Slider x:Name="volumeSlider" Width="100" Minimum="0" Maximum="1" Value="0.5" 
                                    Style="{StaticResource SleekSliderStyle}"
                                    ValueChanged="volumeSlider_ValueChanged" VerticalAlignment="Center"/>
                        </StackPanel>
                    </Grid>
                </Grid>
            </Grid>
        </Grid>
    </Border>
</Window>
